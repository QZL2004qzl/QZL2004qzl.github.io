<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GLAMAIZE</title>
    <style>
        body {
            font-family: 'Arial', sans-serif;
            background-color: #f4f4f9;
            margin: 0;
            padding: 0;
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
        }
        .container {
            background-color: #fff;
            padding: 60px;
            border-radius: 15px;
            box-shadow: 0 8px 30px rgba(0, 0, 0, 0.15);
            width: 60%; /* 调整宽度 */
            max-width: 1000px; /* 增加最大宽度 */
        }
        h1 {
            color: #333;
            text-align: center;
            margin-bottom: 30px;
        }
        .chat-box {
            height: 400px; /* 增加聊天框高度 */
            overflow-y: scroll;
            border: 2px solid #ddd;
            padding: 25px;
            margin-bottom: 30px;
            border-radius: 8px;
            background-color: #f9f9f9;
        }
        .input-box {
            display: flex;
            align-items: center;
        }
        input[type="text"] {
            flex: 1;
            padding: 15px;
            border: 2px solid #ddd;
            border-radius: 8px 0 0 8px;
            font-size: 16px;
        }
        button {
            padding: 15px 30px;
            border: none;
            background-color: #007bff;
            color: #fff;
            border-radius: 0 8px 8px 0;
            cursor: pointer;
            font-size: 16px;
        }
        button:hover {
            background-color: #0056b3;
        }
        .model-select {
            padding: 15px;
            border: 2px solid #ddd;
            border-radius: 8px;
            margin-right: 10px;
            font-size: 16px;
        }
        .checkbox-label {
            margin-right: 10px;
            font-size: 16px;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>GLAMAIZE</h1>
        <div class="chat-box" id="chatBox"></div>
        <div class="input-box">
            <label class="checkbox-label">
                <input type="checkbox" id="censorCheckbox"> 违禁词审核
            </label>
            <input type="text" id="userInput" placeholder="输入你的问题...">
            <select class="model-select" id="modelSelect">
                <option value="GLM">GLM</option>
                <option value="DS">DS</option>
            </select>
            <button onclick="sendMessage()">发送</button>
        </div>
        <button id="formulaButton" onclick="copyFormula()">复制公式</button>
    </div>

    <script>
    let lastResponseLength = 0; // 记录上一次响应的长度

    function sendMessage() {
    const userInput = document.getElementById('userInput').value;
    if (userInput.trim() === '') return;

    const chatBox = document.getElementById('chatBox');
    const userMessage = document.createElement('div');
    userMessage.innerHTML = `${userInput}`;
    userMessage.style.marginBottom = '10px';
    chatBox.appendChild(userMessage);

    const botMessage = document.createElement('div');
    botMessage.style.marginBottom = '10px';
    botMessage.style.color = '#007bff';
    chatBox.appendChild(botMessage);
    chatBox.scrollTop = chatBox.scrollHeight;

    const modelSelect = document.getElementById('modelSelect').value;
    const censorCheckbox = document.getElementById('censorCheckbox').checked;
    let combinedInput = userInput;

    if (censorCheckbox) {
        const prohibitedWordsPrompt = `
化妆品是指以涂擦、喷洒或者其他类似方法，施用于皮肤、毛发、指甲、口唇等人体表面，以清洁、保护、美化、修饰为目的的日用化学工业产品，其作用温和，只是起到辅助作用。对于具有夸大效果、明示或暗示具有医疗作用、或者颇具煽动性的宣传用语，消费者应理性对待。

　　根据《化妆品标识管理规定》《化妆品命名规定》《化妆品命名指南》等文件要求，化妆品宣称用语应根据其语言环境来确定，禁止表达的词意或使用的词语包括但不限于以下词语：

　　1.绝对化词意。如速效、超强、全方位、特级、换肤、去除皱纹等。

　　2.虚假性词意。如只添加部分天然产物成分的化妆品，但宣称产品“纯天然”的，属虚假性词意。

　　3.夸大性词意。如“专业”可适用于在专业店或经专业培训人员使用的染发类、烫发类、指（趾）甲类等产品，但用于其他产品则属夸大性词意。

　　4.医疗术语、明示或暗示医疗作用和效果的词语。如处方、药用、治疗、解毒、抗敏、除菌、无斑、祛疤、生发、溶脂、瘦身及各类皮肤病名称、各种疾病名称等。

　　5.医学名人的姓名。如扁鹊、华佗、张仲景、李时珍等。

　　6.已经批准的药品名。如肤螨灵等。

　　7.与产品的特性没有关联，消费者不易理解的词意。如解码、数码、智能、红外线等。

　　8.庸俗性词意。如“裸”用于“裸体”时属庸俗性词意，不得使用；用于“裸妆”（如彩妆化妆品）时可以使用。

　　9.封建迷信词意。如鬼、妖精、卦、邪、魂。又如“神”用于“神灵”时属封建迷信词意；用于“怡神”（如芳香化妆品）时可以使用。

　　10.超范围宣称产品用途的用语。如特殊用途化妆品宣称不得超出《化妆品卫生监督条例》及其实施细则规定的特殊用途化妆品含义的解释。非特殊用途化妆品不得宣称特殊用途化妆品作用。

    11.利用各种谐音来暗示功效打擦边球的行为，例如:养生用杨生、微针用微晶等等。

##角色定义
 Role: 法规专家
 Background: 用户需要确保化妆品宣称用语符合《化妆品标识管理规定》《化妆品命名规定》《化妆品命名指南》等法规要求。
 Profile: 您是一位熟悉化妆品行业法规的专家，能够准确判断化妆品宣称用语是否合规，并提供专业的法律意见。
 Skills: 法律知识、化妆品行业知识、语言表达能力。

##输出格式
Examples：宣称用语："速效美白，7天见效"
          判断：不符合
          解释：如果不符合就输出给出不符合合理的详细解释。要解释为什么不符合，哪里不符合，怎样不符合。

          建议：
              1.使用"温和改善"代替"速效"，强调产品温和且效果逐渐显现。
              2.强调"长期使用，肌肤逐渐展现自然光泽"，避免承诺具体见效时间。
              3.突出产品成分的天然性，如"富含天然维生素C，助力肌肤自然焕白"。

##
用户输入：userInput
`; combinedInput = `${prohibitedWordsPrompt}\n用户输入：${userInput}`;
    }

    if (modelSelect === 'GLM' || modelSelect === 'DS') {
        const data = {
            model: modelSelect === 'GLM' ? "glm4" : "deepseek-chat",
            messages: [
                { role: "user", content: combinedInput }
            ],
            stream: true,
            censor: censorCheckbox
        };

        const xhr = new XMLHttpRequest();
        const url = modelSelect === 'GLM' ? 'https://glm-kimi-cbpmfpkaox.cn-shanghai.fcapp.run/v1/chat/completions' : 'https://api.deepseek.com/chat/completions';
        xhr.open('POST', url, true);
        xhr.setRequestHeader('Content-Type', 'application/json');
        xhr.setRequestHeader('Authorization', modelSelect === 'GLM' ? 'Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiI4ODAyZDhkNWFmOTA0M2JjYjZmMjc1Mzg5Zjc0YzdkZiIsImV4cCI6MTczNjI1OTM0MiwibmJmIjoxNzIwNzA3MzQyLCJpYXQiOjE3MjA3MDczNDIsImp0aSI6IjdmYTVlYTcwOTM4ZDRkYjQ4ZWFmNjAzMDlhMDUzOGM5IiwidWlkIjoiNjVkMjQ3YzBhYjg1M2YxYTM1ZjFlN2FkIiwidHlwZSI6InJlZnJlc2gifQ.DDYnnH378Wc8l2Pbh9zvJYOYpcdAnBLJbSWy6WNHH_8' : 'Bearer sk-8b55eb37610748039d5c72d860de7e44');
        xhr.responseType = 'text';

        xhr.onreadystatechange = function() {
            if (xhr.readyState === 4 && xhr.status === 200) {
                // 请求完成，不需要额外处理，因为流式数据已经在onprogress中处理了
            }
        };

        xhr.onprogress = function(event) {
            if (xhr.readyState === 3) {
                let responseText = xhr.responseText;
                let newData = responseText.substring(lastResponseLength);
                lastResponseLength = responseText.length;
                let lines = newData.split('\n');
                for (let i = 0; i < lines.length; i++) {
                    let chunk = lines[i];
                    if (chunk.startsWith('data:')) {
                        let chunkData = chunk.substring(5);
                        try {
                            let chunkObj = JSON.parse(chunkData);
                            let content = chunkObj['choices'][0]['delta']['content'];
                            if (content) {
                                // 使用 textContent 来添加文本，这样 \n 就会被处理为换行
                                // 如果需要 <br> 标签，可以将 \n �换为 <br>
                                botMessage.innerHTML += content.replace(/\n/g, '<br>');
                            }
                        } catch (e) {
                            // 如果解析失败，忽略该块
                        }
                    }
                }
                chatBox.scrollTop = chatBox.scrollHeight;
            }
        };

        xhr.send(JSON.stringify(data));
    }

    document.getElementById('userInput').value = '';
}

document.getElementById('userInput').addEventListener('keydown', function(event) {
    if (event.key === 'Enter') {
        sendMessage();
    }
});

function copyFormula() {
    // 复制公式的逻辑（如果需要）
    // ...

    // 跳转到指定的HTML文件
    window.location.href = 'furun.html';
}
    </script>
</body>
</html>
